/* jquery messages V 1.0 by Paulo Regina (www.pauloreg.com) */

function update_unMsg_counter(e,t,n){$.post(e,t,function(e){$("#unreader-count-"+n).html(e);var t=$("#unreader-count-"+n).text();if(t.length==0){$("#unreader-counter"+n).fadeOut(300).remove()}})}$(document).ready(function(){$.base_url="";$("ul#messages-stack-list, #text-messages-request, #text-messages").niceScroll({cursorcolor:"#2f2e2e",cursoropacitymax:.6,boxzoom:false,touchbehavior:true});$("textarea").live("mousemove",function(e){var t=$(this).offset();t.bottom=$(this).offset().top+$(this).outerHeight();t.right=$(this).offset().left+$(this).outerWidth();if(t.bottom>e.pageY&&e.pageY>t.bottom-16&&t.right>e.pageX&&e.pageX>t.right-16){$(this).css({cursor:"nw-resize"})}else{$(this).css({cursor:""})}}).live("keyup",function(e){while($(this).outerHeight()<this.scrollHeight+parseFloat($(this).css("borderTopWidth"))+parseFloat($(this).css("borderBottomWidth"))){$(this).height($(this).height()+1)}});$("li.prepare-message").live("click",function(){var e=$(this).attr("id");var t=$.base_url+"/api/ajax/request_chat_ajax";var n=$.base_url+"/api/ajax/request_chat_ajax/refresh_unreadMessages_ajax";var r="id="+e;$.ajax({type:"POST",url:t,data:r,cache:false,success:function(t){$(".active-message").removeClass("active-message");$("li#"+e+".prepare-message").focus().addClass("active-message");$("#text-messages-request").html(t);update_unMsg_counter(n,r,e)}});return false});$("textarea.type-a-message-box").live("click",function(){var e=$(this).attr("id");var t=$.base_url+"/api/ajax/add_chat_ajax";$("div.message-btn-target").html('<a href="#" id="'+e+'" class="btn btn-default btn-sm send-message"><i class="glyphicon glyphicon-send"></i> Send</a>');$("#type-a-message").remove();$("a.send-message").on("click",function(){var n=$("textarea.type-a-message-box").val();var r="id="+e+"&message="+n;if($.trim(n).length==0){alert("Please write something to send")}else{$.ajax({type:"POST",url:t,data:r,cache:false,success:function(e){$("p.no-messages").remove();$("#text-messages-request").html(e)}})}});return false});$(".load-more-messages").off("click").live("click",function(){var e=$(this).attr("id");var t=$(this).attr("rel");var n=$.base_url+"ajax/chat_more_ajax.php";var r=$.base_url+"ajax/refresh_unreadMessages_ajax.php";var i="lastid="+e+"&uid="+t;if(e){$.ajax({type:"POST",url:n,data:i,cache:false,beforeSend:function(){$("#more"+e).html('<img src="img/ajaxloader.gif" />')},success:function(n){$("div#more"+e+".more-messages-parent").remove();$("#text-messages").append(n);update_unMsg_counter(r,i,t)}})}else{$("#more").html("No Messages")}return false});$("#contacts-search-input").live("click",function(){var e=$("ul#messages-stack-list").html();$(this).keyup(function(){var e=$(this).val();var t="filterword="+e;var n=$.base_url+"/api/ajax/chat_filter_ajax";if($.trim(e).length>0){$.ajax({type:"POST",url:n,data:t,cache:false,success:function(e){$("ul#messages-stack-list").html(e).show()}})}return false});$("ul#messages-stack-list").mouseup(function(){return false});$(document).mouseup(function(){$("ul#messages-stack-list").html(e);$("#contacts-search-input").val("")})});$(".remove-message").off("click").live("click",function(){var e=$(this).attr("id");var t=$(this).data("user");var n=$.base_url+"/api/ajax/chat_remove_ajax";var r="id="+e+"&uid="+t;$.ajax({type:"POST",url:n,data:r,cache:false,success:function(t){$("#u_msg"+e).remove();var n=parseInt($("span#count-old-messages").text());$("span#count-old-messages").html(n-1);if(n==1){$(".more-messages-parent").fadeOut(300).remove()}}});return false});$("#loadingDiv").hide().ajaxStart(function(){$(this).show()}).ajaxStop(function(){$(this).hide()})})